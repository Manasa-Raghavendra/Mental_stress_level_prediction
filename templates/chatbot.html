<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>AI Chatbot</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;

            /* SAME GRADIENT AS DASHBOARD */
            background: linear-gradient(135deg, #1b1b2f, #3d3b59, #5b5877);
            background-size: cover;
            font-family: "Poppins", sans-serif;
            color: white;
        }

        .chat-container {
            width: 420px;
            height: 85vh;

            /* Glass effect */
            background: rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);

            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .header {
            padding: 15px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 0.5px;
            background: rgba(255, 255, 255, 0.12);
            border-bottom: 1px solid rgba(255, 255, 255, 0.18);
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 18px;
        }

        .msg {
            max-width: 78%;
            padding: 12px 16px;
            margin-bottom: 12px;
            border-radius: 14px;
            font-size: 15px;
            line-height: 1.45;
            backdrop-filter: blur(6px);
        }

        /* User bubble (cyan glow) */
        .user {
            background: rgba(0, 230, 255, 0.25);
            color: #eaffff;
            margin-left: auto;
            border-bottom-right-radius: 4px;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.35);
        }

        /* Bot bubble (lavender soft) */
        .bot {
            background: rgba(180, 150, 255, 0.22);
            color: #ffffff;
            margin-right: auto;
            border-bottom-left-radius: 4px;
            box-shadow: 0 0 8px rgba(200, 170, 255, 0.25);
        }

        .input-area {
            display: flex;
            gap: 8px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.08);
            border-top: 1px solid rgba(255, 255, 255, 0.18);
        }

        .input-area input {
            flex: 1;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: none;
            padding-left: 15px;
        }

        .input-area input::placeholder {
            color: #cfcfcf;
        }

        .input-area button {
            border-radius: 25px;
            background: #00d4ff;
            border: none;
            font-weight: 600;
            transition: 0.2s;
        }

        .input-area button:hover {
            background: #29e2ff;
        }

        /* typing dots */
        .typing {
            width: 45px;
            height: 20px;
            display: flex;
            gap: 5px;
            align-items: center;
            margin-bottom: 10px;
        }

        .typing div {
            width: 8px;
            height: 8px;
            background: #ddd;
            border-radius: 50%;
            animation: blink 1.4s infinite both;
        }

        .typing div:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing div:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes blink {
            0% {
                opacity: .2;
            }

            20% {
                opacity: 1;
            }

            100% {
                opacity: .2;
            }
        }
    </style>
</head>

<body>

<div class="chat-container">

    <div class="header">
        ðŸ’¬ AI Chatbot
    </div>

    <div class="messages" id="messages"></div>

    <div class="input-area">
        <input id="userInput" class="form-control" type="text" placeholder="Type a message..."
               onkeypress="handleKey(event)">
        <button onclick="sendMessage()">Send</button>
    </div>

</div>

<script>
    const messageBox = document.getElementById("messages");

    function addMessage(text, sender) {
        const div = document.createElement("div");
        div.className = "msg " + sender;
        div.innerText = text;

        messageBox.appendChild(div);
        messageBox.scrollTop = messageBox.scrollHeight;
    }

    function showTyping() {
        const typing = document.createElement("div");
        typing.className = "typing bot";
        typing.id = "typingAnim";

        typing.innerHTML = `<div></div><div></div><div></div>`;

        messageBox.appendChild(typing);
        messageBox.scrollTop = messageBox.scrollHeight;
    }

    function hideTyping() {
        const typing = document.getElementById("typingAnim");
        if (typing) typing.remove();
    }

    async function sendMessage() {
        const input = document.getElementById("userInput");
        const text = input.value.trim();
        if (text === "") return;

        addMessage(text, "user");
        input.value = "";

        showTyping();

        const response = await fetch("/chatbot_message", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: text })
        });

        const data = await response.json();

        hideTyping();
        addMessage(data.reply, "bot");
    }

    function handleKey(event) {
        if (event.key === "Enter") sendMessage();
    }
</script>

</body>
</html>
